# Тестовое задание для вакансии junior backend developer в MEDODS (для связи tg: https://t.me/Killua_killer).
Данный проект содержит функционал сервиса аутенфикации при помощи jwt-токенов. Система основана на 2-х видах токенов: access и refresh. Access токен - стандартный jwt токен с payload, содержащим в себе стандартные claims, а также guid и session_id. Refresh токен - случаный токен, закодированный в base64. В БД хранится только refresh токен в виде bcrypt хэша
Есть 4 основных операций, а также одна дополнительная, направленная на удобство тестирования работы программы.  
1. ***GetTokens*** - функция для получения пары токенов access и refresh. Функция принимает параметр guid, наличие которого проверяется в БД и создается сессия (имеется возможность нескольких сессий для 1-го пользователя, например с разных устройств)
2. ***RefreshTokens*** - функция для обновления пары токенов на основе пары выданных до этого токенов. Access токен при запросе берется из Authorization хэдера, а refresh передается через json. При этом токены проходят **все необходимые проверки**, включая проверку изменения ip и user-agent, которые передаются через заголовки. Refresh можно сделать только парой токенов, выданной вместе, т.к происходит сравнение refresh токена полученного от пользователя с bcrypt хэшэм refresh токена, который соответствует id сессии, полученной из payload токена access. При изменении ip пользователя отправляется сообщение на вебхук. (лог об отправке находится в логах auth-service). ***ВАЖНО*** при указывании в хедере user-agent браузер все равно ставит свой хэдер и не получается проверить логику работы программы при изменении user-agent, но это поведение можно проверить при запроси при помощи curl.
3. ***GetGUID*** - функция для получения guid пользователя. Данный роут защищен - происходит проверка наличия предоставляемого токена в блэклисте.
4. ***Logout*** - функция для выхода из системы. Добавляет access токен в блэклист, а также удаляется сессия с refresh токеном.
   
Дополнительная функция - ***AddUser*** создана для удобства проверки тестового задания. Она генерирует guid и добавляет пользователя с этим guid в БД. Функция возвращает guid для дальнейших операций. 

# Запуск проекта
1. `git clone https://github.com/Rissochek/MEDODS_test_task.git .` (если уже создали папку для проекта). `git clone https://github.com/Rissochek/MEDODS_test_task.git` (если не создали папку для проекта)
2. Запустите из **корневой директории проекта** команду: `docker compose -f Docker/docker-compose.yml -p auth up -d` и дождитесь сборки проекта (флаг -p auth необязателен, он задает название общему контейнеру)
3. Введите в браузере http://localhost:8082/ или же перейдите по ссылке контейнера со swagger-ui в клиенте docker desktop.

# В случае каких-либо вопросов, улучшений, неполадок обращайтесь в tg: https://t.me/Killua_killer.
